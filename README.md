# OnPrem to Cloud 마이그레이션 프로젝트 정리

## 프로젝트 기간:2023-11 ~ 2024-04

# 역할:AWS Cloud Devops
* 소속팀:Cloud개발팀
* 직책:책임
* 업무:신규 테이블 개발
* 데이터 규모:1 Petabyte
* 데이터 유형:카드사 고객 DB
* 협업 팀:Data Scientist, OnPrem Data Enjineer
* 프로젝트 관리:Jira, Confluence


## 역할 Detail

* 테이블 초기 적재(80 테이블 할당)
* 배포
* 선행 조건
* View 생성
* 데이터 정합성 검증
* 입수 오류 건 로그 분석 후 보고
----------------------------------------------------------------------------------------------------
* 테이블 원천, 마트 테이블 구분(마트 테이블의 경우 기 Sqoop된 테이블로 string 처리 돼있음)
* 데이터 사이즈, 파티션 컬럼, 보관기간을 고려하여 적재 방식(Overwrite, Append, Upsert) 선택
* 데이터 타입에 따른 클렌징 룰 적용(입수 파이프 라인 기준)
* 마트 테이블 파기 컬럼, 암호화 설정
* 테이블 등록 - 배포 - 초기적재
* 초기 적재 후 s3, Athena 쿼리 조회로 데이터 적재 확인 후 view 생성
* 데이터 사이즈가 큰 경우(ex 700GB, 400GB 등) RDS를 통한 Oracle 소스 튜닝(Hint, Fetch 수정) 후 입수
* 입수 오류 건에 대해 Air flow Dags task 확인 후 EMR EC2 컨테이너 로그 확인하여 해결

----------------------------------------------------------------------------------------------------

## AWS 서비스

### S3:저장소
- Sqoop 후 저장되는 HDFS 저장 공간, Glue Studio 등등 모든 저장 공간에 해당 
### EC2:인스턴스
- 운영 체제(리눅스), CPU, RAM 메모리, 스토리지, 서버 네트워크 관리
### EC2:앱 관리 컨테이너
- Sqoop, 얀, 스파크 앱을 관리하는 컨테이너 관리. 오류 관리에 사용
### Lambda:컴퓨팅 서비스
- 서버를 프로비저닝 관리 없이 코드를 실행. 주로 EMR 클러스터 실행에 사용
### RDS(Mysql work bench):RDBMS 관리 
- Mysql, Oracle와 같은 관계형 DB를 관리할 수 있음 
### Glue Studio:파이프라인 구축
- 엔지니어, 데이터 분석가들에게 원하는 데이터를 입수하도록 도와주는 콘솔
### MWAA:데이터 워크 플로(task dag 설정)
- 워크 플로를 관리하는 Air Flow 환경을 VPC 네트워크에 배포 액세스, IAM 역할 설정으로 보안 설정됨
- 각각의 Task는 파이썬 코드로 작성됨
### EMR Cluster:Hadoop Cluster for aws
- 하둡 HDFS(s3) Sqoop 쿼리, Spark 파이썬 코드를 설정하고 Mapreduce 분선 처리 진행
- Yarn(작업 할당 스케줄러)
### Athena: 실시간 쿼리 지원
- 적재된 S3 스토리지 DB에 대해 쿼리 조회할 수 있다

----------------------------------------------------------------------------------------------------

### 초기적재 기본 Process

- 1.파이프라인 클렌징 룰을 기반으로 테이블 등록 작성
- 2.테이블 초기적재
- 3.AirFlow Task 확인
- 4.EMR Cluster SQoop, Spark 매핑, 리듀스 로그 정상 확인
- 5.완료 Task 확인 후 적재된 S3 확인
- 6.Athena 쿼리하여 보관기간에 맞게 잘 들어갔는지 확인
- 7.적재 데이터 건수와 원천 Oracle DB 건수와 정합성 확인
- 8.테이블 Join 컬럼 설정
- 9.사용자(데이터 사이언티스트) 제공 View 생성
- 10.EDA View 생성 조회

----------------------------------------------------------------------------------------------------


### 느낀점

 처음에는 단순히 aws 클라우드를 운영하는 쉬운 업무라고 생각했습니다. 하지만 테이블과 시스템의 전반적인 기본 구조를 알지 못하면 일을 할 수 없었고,
그래서 제 업무와 관련된 산더미 같은 인프라를 정말 열심히 배웠습니다. 그리고 현재는 가까스로 구조에 대한 이해를 가진 상태가 되었고, 나아가 
내가 사용하는 프로그램 및 시스템에 대해 더 잘 알고 싶어 배우는 중입니다. 
그래서 제 업무와 관련된 산더미 같은 인프라를 정말 열심히 배웠습니다. 그리고 현재는 가까스로 구조에 대한 이해를 가진 상태가 되었는데, 아직도 많이
부족하다고 느끼고 배우고 있습니다.







